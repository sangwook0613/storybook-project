# í™”ë©´ êµ¬ì„±í•˜ê¸°

> ì•ì„œ ë§Œë“  ì»´í¬ë„ŒíŠ¸ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ í™”ë©´ì„ êµ¬ì„±í•´ë³´ì

TaskList ë¥¼ ë°”íƒ•ìœ¼ë¡œ Storybook ì— í™”ë©´ì„ ê°œë°œí•˜ì—¬ ì™„ì„±ë„ë¥¼ ë†’ì—¬ë³´ì.

## InboxScreen ì„¤ì •í•˜ê¸°

> TaskList ë¥¼ ê°–ê³  ìˆëŠ” í™”ë©´ì¸ InboxScreen ì„ ì„¤ì •í•´ë³´ì.

InboxScreen ì—ì„œëŠ” `error` ë¼ëŠ” ìƒíƒœë¥¼ ê¸°ë¡í•  ê²ƒì¸ë°,

ì´ `error` ëŠ” ì„œë²„ì—ì„œ Screen ì„ ë¡œë”©í•˜ëŠ” ê³¼ì •ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ í˜ì´ì§€ë¥¼ ë„ìš°ê¸° ìœ„í•œ ìƒíƒœì´ë‹¤.

### Redux ì— error ìƒíƒœ ì¶”ê°€í•˜ê¸°

ê·¸ë ‡ê¸°ì— ìš°ì„ ì ìœ¼ë¡œ, redux store ì— error ê´€ë ¨ ìƒíƒœ ì •ë³´ë¥¼ ì—…ë°ì´íŠ¸í•´ì¤˜ì•¼ í•œë‹¤.

> src/lib/redux.js

```jsx
// redux toolkit ì„ í™œìš©í•˜ì—¬ ê°„ë‹¨í•œ redux ì„¤ì •í•˜ê¸°
import { configureStore, createSlice } from "@reduxjs/toolkit";

// error ì •ë³´ì™€ ê´€ë ¨ëœ ìƒˆë¡œìš´ slice ë¥¼ ì¶”ê°€í•œë‹¤.
const AppStateSlice = createSlice({
  name: "appState",
  initialState: "", // error ëŠ” string í˜•íƒœì˜ inital state ë¥¼ ê°–ëŠ”ë‹¤.
  reducers: {
    updateAppState: (state, action) => {
      return {
        ...state,
        isError: action.payload,
      };
    },
  },
});


...


// ì—ëŸ¬ ê´€ë ¨ action ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ export
export const { updateAppState } = AppStateSlice.actions;


// configureStore ë¥¼ ì‚¬ìš©í•´ì„œ store ë¥¼ ìƒì„±
const store = configureStore({
  reducer: {
    tasks: TasksSlice.reducer,
    isError: AppStateSlice.reducer, // ì—ëŸ¬ ê´€ë ¨ reducer ë¥¼ ì¶”ê°€í•œë‹¤.
  },
});

export default store;
```



### InboxScreen êµ¬í˜„

reduxì— error ìƒíƒœë¥¼ ë°˜ì˜í–ˆë‹¤ë©´ InboxScreen ì„ êµ¬í˜„í•œë‹¤.

> src/components/InboxScreen.js

```jsx
import React from 'react';
import PropTypes from 'prop-types';
import { useSelector } from "react-redux";
import { TaskList } from "./TaskList";

export function PureInboxScreen({ error }) {
  // ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•œ ê²½ìš°
  if (error) {
    return (
      <div className="page lists-show">
        <div className="wrapper-message">
          <span className="icon-face-sad" />
          <div className="title-message">Oh no!</div>
          <div className="subtitle-message">Something went wrong</div>
        </div>
      </div>
    );
  }
  return (
    <div className="page lists-show">
      <nav>
        <h1 className="title-page">
          <span className="title-wrapper">Taskbox</span>
        </h1>
      </nav>
      <TaskList />
    </div>
  );
}

PureInboxScreen.propTypes = {
  // ì—ëŸ¬ë©”ì„¸ì§€ëŠ” string íƒ€ì…ì´ë‹¤.
  error: PropTypes.string,
};

PureInboxScreen.defaultProps = {
  error: null,
};

export function InboxScreen() {
  // useSelector ë¥¼ í™œìš©í•˜ì—¬ store ì— ì €ì¥ë˜ì–´ ìˆëŠ” isError ê°’ì„ error props ë¡œ ë„˜ê¸´ë‹¤.
  const isError = useSelector((state) => state.isError);

  return <PureInboxScreen error={isError} />;
}
```

- useSelector ë¥¼ í™œìš©í•˜ì—¬ store ì— ì €ì¥ë˜ì–´ ìˆëŠ” isError ê°’ì„ error props ë¡œ ë„˜ê¸´ë‹¤.



### InboxScreen ë Œë”ë§

App.js ì— InboxScreen ì„ import í•˜ì—¬ ë Œë”ë§í•œë‹¤.

> App.js

```jsx
import React from 'react';
import { Provider } from 'react-redux';
import store from './lib/redux';
import { InboxScreen } from "./components/InboxScreen";
import './index.css';

function App() {
  return (
    <Provider store={store}>
      <InboxScreen />
    </Provider>
  );
}
export default App;
```



### InboxScreen ìŠ¤í† ë¦¬ ë§Œë“¤ê¸°

> src/components/InboxScreen.stories.js

```js
import React from 'react';

import { PureInboxScreen } from './InboxScreen';

export default {
  component: PureInboxScreen,
  title: 'PureInboxScreen',
};

const Template = args => <PureInboxScreen {...args} />;

export const Default = Template.bind({});

export const Error = Template.bind({});
Error.args = {
  error: 'Something',
};
```

ë‹¤ë§Œ ì´ë ‡ê²Œ ìƒì„±í•œ í›„ì— ìŠ¤í† ë¦¬ë¶ì„ ë Œë”í•˜ë©´ PureInboxScreen ì˜ default ìŠ¤í† ë¦¬ì— ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

<img src="5. í™”ë©´ êµ¬ì„±í•˜ê¸°.assets/image-20220211180650372.png" alt="image-20220211180650372" style="zoom:50%;" />



PureInboxScreen  ê°€ error ìŠ¤í† ë¦¬ì¼ë•ŒëŠ” ë”°ë¡œ ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë° ì´ ì´ìœ ëŠ” default ë¥¼ ë Œë”ë§í•  ë•Œ, redux store ê°€ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì¸ TaskList ê¹Œì§€ ì—°ê²°ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê·¸ë ‡ë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ìœ¼ë¡œëŠ” í¬ê²Œ 2ê°€ì§€ê°€ ìˆë‹¤.

1. ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§ë˜ëŠ” App ì»´í¬ë„ŒíŠ¸ì— ì„ ì–¸í•˜ëŠ” ê²ƒì´ë‹¤.
   - í•˜ì§€ë§Œ ì½”ë“œë¥¼ êµ¬ì„±í•˜ëŠ” ì…ì¥ì—ì„œ ê³„ì¸µì ìœ¼ë¡œ ì§œì§€ ì•ŠëŠ” ê²ƒì€ ë§¤ìš° ë¹„íš¨ìœ¨ì ì´ë‹¤.

2. decorators ì„ í™œìš©í•´ì„œ Redux storeì˜ ëª¨ë°©ëœ ë²„ì „ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.
   - ì´ë²ˆ íŠœí† ë¦¬ì–¼ì—ì„œëŠ” ì´ ë°©ë²•ì„ í™œìš©í•  ì˜ˆì •ì´ë‹¤.



### ëª¨ë°©ëœ Redux store ì‚¬ìš©í•˜ê¸°

> ëª¨ë°©ëœ(mocked) Redux store ë¥¼ ì‚¬ìš©í•˜ì—¬ PureInboxScreen ìŠ¤í† ë¦¬ì— ì—°ê²°í•˜ì—¬ TaskList ê¹Œì§€ store ê°€ ì—°ê²°ë  ìˆ˜ ìˆë„ë¡ í•˜ì.

> src/components/PureInboxScreen.stories.js

```jsx
import React from 'react';
import { Provider } from 'react-redux';
import { configureStore, createSlice } from '@reduxjs/toolkit';
import { PureInboxScreen } from './InboxScreen';
import * as TaskListStories from './TaskList.stories';

// ê°„ë‹¨í•œ ëª¨ë°©ëœ ë²„ì „ì˜ redux store ìƒì„±
const Mockstore = configureStore({
  reducer: {
    tasks: createSlice({
      name: 'tasks',
      initialState: TaskListStories.Default.args.tasks,
      reducers: {
        updateTaskState: (state, action) => {
          const { id, newTaskState } = action.payload;
          const task = state.findIndex((task) => task.id === id);
          if (task >= 0) {
            state[task].state = newTaskState;
          }
        },
      },
    }).reducer,
  },
});

export default {
  component: PureInboxScreen,
  // decorators ë¥¼ í†µí•´ì„œ store ì—°ê²°í•˜ê¸°
  decorators: [story => <Provider store={Mockstore}>{story()}</Provider>],
  title: 'PureInboxScreen',
};

const Template = args => <PureInboxScreen {...args} />;

export const Default = Template.bind({});

export const Error = Template.bind({});
Error.args = {
  error: 'Something',
};
```

ì´ë ‡ê²Œ ëª¨ë°©ëœ Redux store ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ default ìƒíƒœê°€ ì •ìƒì ìœ¼ë¡œ ë Œë”ë§ëœ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.



<img src="5. í™”ë©´ êµ¬ì„±í•˜ê¸°.assets/finished-inboxscreen-states-6-0.gif" alt="finished-inboxscreen-states-6-0" style="zoom:80%;" />



### ìƒí˜¸ì‘ìš©í•˜ëŠ” ìŠ¤í† ë¦¬

> ìë™ì ìœ¼ë¡œ ëª‡ ê°€ì§€ UI íë¦„ì„ ë³´ì—¬ì£¼ë„ë¡ ìŠ¤í† ë¦¬ë¥¼ ì¶”ê°€í•´ë³´ì.

ì´ë¥¼ ìœ„í•´ì„œ Storybook ì—ì„œ ì œê³µí•˜ëŠ” `play` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ê²ƒì´ë‹¤.

#### `play` í•¨ìˆ˜

> ë³´ë‹¤ ìì„¸í•œ ì •ë³´ëŠ” [ì´ ë§í¬](https://storybook.js.org/docs/react/writing-stories/play-function)ë¥¼ ì°¸ê³ í•˜ì.

`play` í•¨ìˆ˜ëŠ” task ê°€ ì—…ë°ì´íŠ¸ ë˜ì—ˆì„ ë•Œ, UI ìƒìœ¼ë¡œ ì–´ë–¤ ë³€í™”ê°€ ì¼ì–´ë‚¬ëŠ”ì§€ ë³´ì—¬ì¤€ë‹¤.

`play` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìš°ì„  ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•œ í›„

```bash
# With npm
npm install @storybook/addon-interactions @storybook/testing-library --save-dev

# With yarn
yarn add --dev @storybook/addon-interactions @storybook/testing-library
```

Storybook configuration (.storybook/main.js) ë¥¼ ìˆ˜ì •í•´ì¤˜ì•¼ í•œë‹¤.

> .storybook/main.js

```js
module.exports = {
  stories:[],
  addons:[
    // Other Storybook addons
    '@storybook/addon-interactions', //ğŸ‘ˆ ì—¬ê¸°ì— ì¶”ê°€í•´ì¤˜ì•¼ í•œë‹¤!!
};
```

ì´ë¥¼ ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ë³´ì.

> src/components/PureInboxScreen.stories.js

```js
import React from 'react';
import { Provider } from 'react-redux';
import { configureStore, createSlice } from '@reduxjs/toolkit';
+ import { fireEvent, within } from '@storybook/testing-library';

import { PureInboxScreen } from './InboxScreen';

import * as TaskListStories from './TaskList.stories';

 // A super-simple mock of a redux store
const Mockstore = configureStore({
  reducer: {
    tasks: createSlice({
      name: 'tasks',
      initialState: TaskListStories.Default.args.tasks,
      reducers: {
        updateTaskState: (state, action) => {
          const { id, newTaskState } = action.payload;
          const task = state.findIndex((task) => task.id === id);
          if (task >= 0) {
            state[task].state = newTaskState;
          }
        },
      },
    }).reducer,
  },
});

export default {
  component: PureInboxScreen,
  decorators: [story => <Provider store={Mockstore}>{story()}</Provider>],
  title: 'PureInboxScreen',
};

const Template = args => <PureInboxScreen {...args} />;

export const Default = Template.bind({});

export const Error = Template.bind({});
Error.args = {
  error: 'Something',
};


// ìë™ì ìœ¼ë¡œ UI ì˜ ë³€í™”ë¥¼ ë³´ì—¬ì£¼ëŠ” ìŠ¤í† ë¦¬
// ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
+ export const WithInteractions = Template.bind({});
+ WithInteractions.play = async ({ canvasElement }) => {
+   const canvas = within(canvasElement);
+   // ì²« ë²ˆì§¸ Task ì— ì¤‘ìš” í‘œì‹œë¥¼ í•œë‹¤(pinned)
+   await fireEvent.click(canvas.getByLabelText("pinTask-1"));
+   // ì„¸ ë²ˆì§¸ Task ì— ì¤‘ìš” í‘œì‹œë¥¼ í•œë‹¤(pinned)
+   await fireEvent.click(canvas.getByLabelText("pinTask-3"));
+ };
```

ìœ„ì™€ ê°™ì´ ìˆ˜ì •í•œ ê²°ê³¼ ì•„ë˜ì˜ ê²°ê³¼ë¬¼ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.



<img src="5. í™”ë©´ êµ¬ì„±í•˜ê¸°.assets/storybook-interactive-stories-play-function.gif" alt="storybook-interactive-stories-play-function" style="zoom:80%;" />







### ++ Test ì½”ë“œ ìˆ˜ì •

@storybook/testing-react ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •

ì„¤ì¹˜

```bash
npm install @storybook/testing-react
```

> src/components/TaskList.test.js

```js
import { render } from "@testing-library/react";
import { composeStories } from "@storybook/testing-react";
import * as TaskListStories from "./TaskList.stories"; //ğŸ‘ˆ  Our stories imported here

//ğŸ‘‡ composeStories will process all information related to the component (e.g., args)
const { WithPinnedTasks } = composeStories(TaskListStories);

it("renders pinned tasks at the start of the list", () => {
  const { container } = render(<WithPinnedTasks />);

  // ë§¨ ë§ˆì§€ë§‰ task ì¸ 6ë²ˆ task ê°€ ë§ˆì§€ë§‰ì´ ì•„ë‹Œ ë§¨ìœ„ì— ì˜¤ê¸°ë¥¼ í¬ë§í•œë‹¤.
  expect(
    container.querySelector(
      '.list-item:nth-child(1) input[value="Task 6 (pinned)"]'
    )
  ).not.toBe(null);
});
```

